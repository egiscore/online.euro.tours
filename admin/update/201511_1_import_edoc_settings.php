<?php
 class import_edoc_settings extends UpdateModel { public $title = 'Настройки выдачи документов'; public function make() { $params = ['EdocWorkDays' => 0]; $edoc_check_type = (defined('EDOC_CHECK_TYPE')) ? EDOC_CHECK_TYPE : 0; $params['EdocAvailability'] = $edoc_check_type; $limit_edoc = $this->db->fetchOne("EXEC " . $this->OFFICEDB . ".dbo.sp_executesql N' SELECT [dbo].[uf_WEB_3_online_config](''LIMIT_EDOC'', ''online_config'', NULL, ''ALWAYS'') AS [value] '"); $params['EdocDeadline'] = ($limit_edoc == 'TOUR_DATEBEG') ? 1 : (($limit_edoc == 'TOUR_DATEEND') ? 2 : 0); foreach ($params as $param => $value) { $sql = $this->db->formatExec( $this->OFFICEDB . '.Settings.SetParam', [ 'p_user_code' => null, 'p_section' => 'Online', 'p_name' => $param, 'p_value' => $value, ] ); $this->db->query($sql); } return 0; } } 