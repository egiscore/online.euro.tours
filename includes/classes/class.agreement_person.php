<?php
 class Agreement_Person extends Samo { private $claim = null; private $partner = null; private $tour = null; private $params = []; public function claim($claim = null) { if (null !== $claim) { $this->claim = $claim; } return $this->claim; } public function tour($tour = null) { if (null !== $tour) { $this->tour = $tour; } return $this->tour; } public function partner($partner = null) { if (null !== $partner) { $this->partner = $partner; } return $this->partner; } public function params($params = null) { if (null !== $params) { $this->params = $params; } return $this->params; } public function template() { if (isset($this->claim) && !isset($this->partner)) { $claim = Samo_Loader::load_object('Samo_Claim'); $claim->construct($this->claim); $info = $claim->claimInfo(); $this->partner = $info['PartnerInc']; $this->tour = $info['TourInc']; } return $this->get_settings_printform(DocCategory::AGREEMENT_PERSON, $this->partner, $this->tour); } protected function getExternalDocumentInit() { if ($this->claim) { return $this->getExternalDocumentJob(sprintf('agreement_person_%d.pdf', $this->claim), sprintf('agreement_person_%d_%%s_%%s.pdf', $this->claim)); } else { $params = []; if (null !== $this->partner) { $params[] = $this->partner; } if (null !== $this->tour) { $params[] = $this->tour; } return $this->getExternalDocumentJob('agreement_person_preview.pdf', sprintf('agreement_person_preview%s.pdf', count($params) ? '_' . implode('_', $params) : '')); } } protected function getExternalDocumentParams() { if (false !== ($tpl = $this->template())) { $params = ['template' => $tpl, 'partner' => $this->partner]; if ($this->claim) { $params['claim'] = $this->claim; } return array_merge($params, $this->params()); } $messages = Samo_Registry::get('messages'); throw new Samo_Exception($messages['TEMPLATE_NOT_CONFIGURE']); } } 