<?php
 class Payture { protected $key = null; protected $host = null; protected $password = null; public function __construct($host, $key, $password) { $this->key = $key; $this->host = $host; $this->password = $password; } protected function doRequest($path, $params) { $res = Samo_Curl::request($this->host . $path, $params); $res = json_decode($res, true); if (!$res['Success']) { throw new Samo_Exception('Payture - ' . $res['ErrCode']); } return $res; } public function sendCheck($data, $id, $inn, $tax, $taxSystem, $paymentType, $message, $contacts) { $pos = []; $pay = []; foreach ($data as $d) { $pos[] = [ 'Quantity' => 1.00, 'Price' => $d['price'], 'Tax' => $tax, 'Text' => Samo_String::set($d['label'])->utf8()->__toString(), ]; $pay[] = [ 'Type' => $paymentType, 'Amount' => $d['price'], ]; } $json = [ 'Key' => $this->key, 'Password' => $this->password, 'Cheque' => [ 'Id' => $id, 'INN' => $inn, 'Group' => 'Main', 'Content' => [ 'Type' => '1', 'Positions' => $pos, 'CheckClose' => [ 'Payments' => $pay, 'TaxationSystem' => $taxSystem, ], 'CustomerContact' => $contacts, 'Message' => Samo_String::set($message)->utf8()->__toString(), ], ], ]; $this->doRequest('apicheque/Create/', json_encode($json)); } } 