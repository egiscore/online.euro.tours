<?php
 function smarty_function_map_init($params, &$smarty) { $view = ($smarty instanceof Samo_View) ? $smarty : Samo_Registry::get('view'); $keys = array('latitude', 'longitude', 'title'); $point = array(); if (isset($params['point'])) { $point = $params['point']; if (isset($point['lname'])) { $point['title'] = $point['lname']; } } foreach ($keys as $key) { if (isset($params[$key])) { $data[$key] = $params[$key]; } elseif (isset($point[$key])) { $data[$key] = $point[$key]; } } $map_key = Samo_Registry::get('controller')->model->getConfig('MAP_KEY', 'online_config', ''); if ($map_key != '') { $data['key'] = $map_key; } $return = ''; if (isset($data['key']) && isset($data['latitude']) && isset($data['longitude'])) { if (isset($data['title'])) { $data['title'] = $view->jsencode($data['title']); } $return = "data-map-options='" . $view->json_encode($data, '"') . "'"; if (isset($params['div']) && $params['div']) { $return = "<div class='" . (is_string($params['div']) ? $params['div'] : 'map_container') . "' " . $return . "></div>"; } } return $return; } 