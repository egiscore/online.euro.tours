<?php
function smarty_prefilter_static_loader($tpl_source, $smarty) { if (preg_match_all('~{((?:js|css|img)load) ([^}]+)}~iU', $tpl_source, $matches)) { $HELPERS = dirname(__FILE__); foreach ($matches[1] as $idx => $func) { $function = 'smarty_function_' . $func; if (!function_exists($function)) { include $HELPERS . '/function.' . $func . '.php'; } $params = array(); $can_replace = true; if (preg_match_all('~(.+)=(\$[^\s]+\s|(:?"|\').*(:?"|\')|true|false)~iU', $matches[2][$idx] . ' ', $tmp)) { foreach ($tmp[1] as $_idx => $param) { $name = trim($param); $value = trim($tmp[2][$_idx], '"\''); if ($value == 'true') { $value = true; } elseif ($value == 'false') { $value = false; } elseif ('$' == substr($value, 0, 1)) { if (!$value = $smarty->getTemplateVars(substr($value, 1))) { $can_replace = false; break; } } $params[$name] = $value; } if ($can_replace) { $tpl_source = str_replace($matches[0][$idx], $function($params, $smarty), $tpl_source); } } } } return $tpl_source; } 