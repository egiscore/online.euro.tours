<?php
class Agencies_Api extends Api_Model { public function __construct(Samo_Config $config, $callback = null) { parent::__construct($config, $callback); $this->field_type['integer'][] = 'METROSTATION'; $this->field_type['integer'][] = 'TOWN'; $this->field_type['integer'][] = 'PARTNER'; $this->field_type['string'][] = 'QUERY'; } protected function _getTOWNS() { $sql = $this->db->formatExec('<OFFICEDB>.dbo.up_WEB_3_agencies_TownList', ['UserCode' => $this->internet_user()]); $result = $this->db->fetchAll($sql); return false !== $result ? $result : []; } protected function _getMETROSTATIONS() { $sql = $this->db->formatExec( '<OFFICEDB>.dbo.up_WEB_3_agencies_MetrostationList', [ 'Town' => $this->getParam('TOWN'), 'UserCode' => $this->internet_user(), ] ); $result = $this->db->fetchAll($sql); return false !== $result ? $result : []; } protected function _getSearch() { $sql = $this->db->formatExec( '<OFFICEDB>.dbo.up_WEB_4_agencies_search', [ 'Town' => $this->getParam('TOWN'), 'Metrostation' => $this->getParam('METROSTATION'), 'Query' => $this->getParam('QUERY'), 'UserCode' => $this->internet_user(), ] ); $result = $this->db->fetchAll($sql); return false !== $result ? $result : []; } protected function _getInfo() { $sql = $this->db->formatExec( '<OFFICEDB>.dbo.up_WEB_4_partner_info', [ 'Partner' => $this->getParam('PARTNER'), 'UserCode' => $this->internet_user(), ] ); $result = $this->db->fetchOneRow($sql); return false !== $result ? $result : null; } } 