<?php
 class Aviaticket_Controller extends Samo_Controller { public function PDF_TICKET() { try { if ($this->model->is_enabled()) { $this->model->getPDF_TICKET(); $this->model->SaveAviaticket(); $this->render_pdf(); } } catch (Samo_Exception $e) { $this->view->error($e->getMessage()); } } public function render_pdf() { $model = $this->model; $anumber = preg_replace('~[^a-z0-9]~i', '_', $model->defaults['TICKET_NUMBER']); $code = uniqid(); $pdf_file = sprintf('dnl/a_%s_%s.pdf', $anumber, $code); $this->view->assign('people', $model->defaults['RESULT']['PEOPLEINFO']) ->assign('claiminfo', $model->defaults['claim_info']) ->assign('claim', $model->defaults['CLAIM']) ->assign('ticket_number', trim($model->defaults['TICKET_NUMBER'])) ->assign('freights', $model->defaults['RESULT']['ORDERINFO']) ->assign('partner', $model->partner_info()) ->render_fpdf($model->defaults['template'], $pdf_file); $pdf_url = WWWROOT . $pdf_file; Samo_Registry::get('response')->redirect_to($pdf_url); } public function document() { if ($this->model->is_enabled()) { $response = Samo_Registry::get('response'); $doc = Samo_Request::intval('DOC'); if ($doc) { $this->model->SaveAviaticket(); if (false !== ($doc_file = $this->model->external_document($doc))) { $response->redirect_to($doc_file); return; } } $response->not_found(); } else { $this->view->error($this->messages['CL_DOC_PRINT_DISABLED']); } } } 