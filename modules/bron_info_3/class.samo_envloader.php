<?php
 class Samo_EnvLoader { private $db = null; private $messages = null; protected $TOWNFROMINC = 1; protected $STATEINC = 1; protected $langId = 0; protected $packetinfo = array(); protected $strict_check = true; protected $config = null; public function __construct(Samo_Config $config, Packet_Info $packetinfo = null, $strict_check = true) { $this->db(); $this->config = $config; $this->strict_check($strict_check); $this->packetInfo($packetinfo); } public function packetInfo(Packet_Info $packetinfo = null) { if (null !== $packetinfo) { $this->packetinfo = $packetinfo; } return $this->packetinfo; } public function strict_check($param = null) { if (null === $param) { return $this->strict_check; } else { return $this->strict_check = (bool)$param; } } public function db() { if (null == $this->db) { $this->db = Samo_Registry::get('db'); $registry = Samo_Registry::instance(); if (isset($registry['ServerSettings'])) { $tmp = $registry['ServerSettings']; $this->TOWNFROMINC = $tmp['townFrom']; $this->STATEINC = $tmp['state']; } } return $this->db; } public function messages($key) { if (null == $this->messages) { $registry = Samo_Registry::instance(); if (!isset($registry['messages']) || !isset($registry['messages'][$key])) { $messages = array(); include _ROOT . 'includes/messages/messages_' . Samo_Request::lang() . '.php'; include _ROOT . 'modules/bron_info_3/lang/messages_' . Samo_Request::lang() . '.php'; $registry['messages'] = $messages; } $this->messages = $registry['messages']; } return (isset($this->messages[$key])) ? $this->messages[$key] : $key; } public function config($param, $module = 'online_config') { if ($this->packetinfo) { $townfrom = $this->packetinfo['TownFromInc']; $state = $this->packetinfo['StateInc']; $tour = $this->packetinfo['TourInc']; } else { $townfrom = null; $state = null; $tour = null; } return $this->config->get($param, $module, $townfrom, $state, $tour); } public function internet_user() { return $this->config->get('INTERNET_USER'); } public function langId($langId = null) { if (null !== $langId) { $this->langId = $langId; } return (null === $this->langId) ?: Samo_Request::langid(); } public function partpass() { if (isset($_SESSION['samo_auth'])) { return $_SESSION['samo_auth']['PartPassInc']; } return false; } public function partner() { if (isset($_SESSION['samo_auth'])) { return $_SESSION['samo_auth']['Partner']; } return false; } } 