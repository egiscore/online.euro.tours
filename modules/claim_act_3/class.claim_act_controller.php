<?php
 class Claim_Act_Controller extends Samo_Controller { public function default_action() { $this->view->assign('PERSONAL_AREA', Profile_Model::links()); try { $this->view->assign('acts', $this->model->acts()); parent::default_action(); } catch (Samo_Exception $e) { $this->view->error($e->getMessage()); } } public function download($acts = null) { if (true !== ($res = $this->model->get_template_claim_act())) { $this->view->error($res); } else { if ($this->model->external) { $this->PDF_SAMOTOUR(); } else { $code = uniqid(); $pdf_file = sprintf('dnl/act_%s.pdf', $code); $acts = (is_null($acts)) ? $this->model->act() : $acts; if ($acts) { $this->view->assign('acts', $acts) ->render_fpdf('claim_act.fpdf', $pdf_file); $pdf_url = WWWROOT . $pdf_file; Samo_Registry::get('response')->redirect_to($pdf_url); } else { $this->view->error($this->messages['ACT_NOT_FOUND']); } } } } } 