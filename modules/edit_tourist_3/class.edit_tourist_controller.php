<?php
 class Edit_Tourist_Controller extends Samo_Controller { public function construct() { $this->view->assign('MAXLONGINT', Samo::MAXLONGINT); } public function default_action() { try { $inc = Samo_Request::get('PEOPLE'); if (false !== ($result = $this->model->find($inc))) { $this->view->assign('TOURIST', $result) ->assign('CLAIM', $this->model->defaults['CLAIM']); if ($reason_for_readonly = $this->model->last_error()) { $this->view->assign('reason_for_readonly', $reason_for_readonly); } $this->default_app_env(); if (Samo_Registry::get('response')->respond_to_js()) { $this->view->popup_template('form.tpl', $this->messages['EDIT_TOURIST_CAPTION'], 400, 340) ->js_call('samo.edit_tourist'); } else { $this->view->render('layout'); } } } catch (Samo_Exception $e) { $this->view->error($e->getMessage()); } } public function SAVE() { try { $claim = $this->model->defaults['CLAIM']; $collection = Samo_Request::post('frm'); if (is_array($collection)) { foreach ($collection as $data) { foreach ($data as $inc => $params) { $this->model->save($inc, $params); } } } if (!Samo_Request::get('is_layout')) { $this->view->js_call('samo.load_orders', $claim) ->popup_close(); } else { $this->view->message($this->messages['SAVED_IS_OK']); } } catch (Samo_People_Exception $e) { $errors = $e->getErrors(); foreach ($errors as $error => $fields) { foreach ($fields as $field) { $this->view->js_call('samo.field.error', $error, '[name*="' . $field['FormField'] . '"]'); } } Samo_Registry::get('response')->flush(); } catch (Samo_Exception $e) { $this->view->error($e->getMessage()); } } } 