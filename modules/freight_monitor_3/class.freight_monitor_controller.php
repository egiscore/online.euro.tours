<?php
 class Freight_Monitor_Controller extends Samo_Controller { public function construct() { $this->actions = array( 'INIT' => array('SOURCE', 'TARGET', 'PERIOD', 'CHECKIN', 'CHECKOUT', 'AIRLINE', 'PLUS_MINUS'), 'SOURCE' => array('TARGET', 'AIRLINE'), 'TARGET' => array('AIRLINE'), ); $this->options_only = array('SOURCE', 'TARGET'); } public function default_action() { $this->init_data(); $this->view->js_var('samo.PERIOD', $this->model->getPERIOD()); if (Samo_Request::get('DOLOAD')) { $this->loadFreights(); } parent::default_action(); } public function FREIGHTS() { $this->loadFreights(); $this->view->element_update('resultset', 'resultset.tpl'); } protected function loadFreights() { $this->view->assign('lang', $this->messages) ->assign('freights', $this->model->getFreightList()) ->assign('SHOW_PLACES', $this->model->defaults['SHOW_PLACES']); } public function samo_action($action) { if (!isset($this->actions[$action])) { Samo_Registry::get('response')->not_found(); } foreach ($this->actions[$action] as $control) { if (false !== ($result = $this->model->loadData($control))) { if ($control !== 'AIRLINE') { $this->view->add_options($control, $result, 'controls.tpl'); } else { $this->view->add_options($control, $result, '../api_controls.tpl'); } } } return true; } } 