<?php
 class Hotel_Stopsale_Model extends Samo_Tourinfo { public function construct() { $this->defaults['ORDER_BY_NAME'] = $this->getConfig('ORDER_BY_NAME'); $this->defaults['HOTELINC'] = Samo_Request::intval('HOTELINC'); $this->defaults['TOWNTO'] = Samo_Request::intval('TOWNTO'); $this->defaults['MARKETINC'] = (defined('MARKETINC') ? MARKETINC : null); } public function getTOWNFROMINC() { return $this->api()->getTOWNFROMS(); } public function getSTATEINC() { $messages = Samo_Registry::get('messages'); if (!$this->defaults['TOWNFROMINC']) { $this->defaults['TOWNFROMINC'] = TOWNFROMINC; } $api = $this->api(); $states = $api->getSTATES(); if (!empty($states)) { return $states; } return array_merge( array( array( 'id' => 0, 'name' => $messages['STATE_ANY_LNAME'], 'nameAlt' => $messages['STATE_ANY_NAME'], 'selected' => false ) ), $states ); } public function getHOTELINC() { $hotels = $this->api()->getHOTELS(); return array_merge( array( array( 'id' => 0, 'name' => '----', 'nameAlt' => '----', 'selected' => false ) ), $hotels ); } public function getTOWNTO() { $towns = $this->api()->getTOWNS(); if (!empty($towns)) { return $towns; } return array_merge( array( array( 'id' => 0, 'name' => '----', 'nameAlt' => '----', 'selected' => false ) ), $towns ); } public function getStopsales() { if ($data = $this->api()->getSTOP_SALES()) { $messages = Samo_Registry::get('messages'); foreach ($data as $key => $row) { $data[$key]['type'] = ''; $data[$key]['note'] = ($row['note'] == Samo::MAXLONGINT) ? '' : $row['note']; if (!empty($row['spo'])) { $data[$key]['type'] .= sprintf($messages['H_STOPSALE_SPO'], $row['spo']) . '<br>'; } if (1 == $row['type']) { $data[$key]['type'] .= sprintf(($row['nights']) ? $messages['H_STOPSALE_NIGHTS'] : $messages['H_STOPSALE_ZAEZD'], $row['nights']) . '<br>'; } if (!empty($row['programType'])) { $data[$key]['type'] .= sprintf($messages['H_STOPSALE_PTYPE'], $row['programType']); } } } return (!empty($data)) ? $data : false; } } 