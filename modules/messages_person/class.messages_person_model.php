<?php
class Messages_Person_Model extends Messages_Model { protected $auth_required = array('person'); protected $messageType = 4; public function filter($filter = 0, $page = 1, $parent = null, $claim = null, $buyer = null) { $this->rec_on_page = 10000; $buyer = isset($_SESSION['samo_auth']['PhysBuyerInc']) ? $_SESSION['samo_auth']['PhysBuyerInc'] : null; $claim = isset($_SESSION['samo_auth']['CLAIM']) ? $_SESSION['samo_auth']['CLAIM'] : null; return parent::filter($filter, $page, $parent, $claim, $buyer); } public function add($text = null, $claim = null) { $text = Samo_Utils::ifs($text, Samo_Request::strval('TEXT', 1)); return $this->message($text, null, $claim, $this->messageType); } protected function message($text, $parent = null, $claim = null, $messagetype = null) { $claim = ($claim && isset($_SESSION['samo_auth']['ClaimList']) && in_array($claim, $_SESSION['samo_auth']['ClaimList'])) ? $claim : false; return $claim ? parent::message($text, null, $claim, $messagetype) : false; } public function unreadCount($claim = null, $buyer = null) { $claim = isset($_SESSION['samo_auth']['CLAIM']) ? $_SESSION['samo_auth']['CLAIM'] : null; $buyer = Samo_Utils::ifs($buyer, isset($_SESSION['samo_auth']['PhysBuyerInc']) ? $_SESSION['samo_auth']['PhysBuyerInc'] : null); return $buyer ? parent::unreadCount($claim, $buyer) : false; } } 