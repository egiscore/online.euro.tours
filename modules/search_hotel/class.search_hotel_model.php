<?php
 class Search_Hotel_Model extends Search_Tour_Model { protected $api_name = 'Search_Hotel_Api'; public function __construct() { $this->defaults['TOWNFROMINC'] = Samo::TOWNFROMHOTELINC; $this->defaults['STATEFROM'] = (defined('STATEFROM') ? STATEFROM : Samo_Request::intval('STATEFROM', 1, 99999)); $this->defaults['STATEINC'] = Samo_Request::intval('STATEINC', 1, 99999); $this->findCatalogDb(); parent::__construct(); } private function findCatalogDb() { $servers = getServers(); $defaultTown = Samo_Request::intval('TOWNFROMINC'); if (!$defaultTown) { $defaultTown = TOWNFROMINC; } if (!($stateFrom = $this->defaults['STATEFROM'])) { foreach ($servers as $server) { if ($server['townFrom'] == $defaultTown) { $stateFrom = $server['stateFrom']; break; } } } if (!($state = $this->defaults['STATEINC'])) { foreach ($servers as $server) { if ($server['townFrom'] == Samo::TOWNFROMHOTELINC && $server['stateFrom'] == $stateFrom) { $state = $server['state']; } } } foreach ($servers as $server) { if ($server['townFrom'] == Samo::TOWNFROMHOTELINC && $server['stateFrom'] == $stateFrom && $server['state'] == $state) { db_connect($server['townFrom'], $server['state'], ['stateFrom' => $stateFrom]); break; } } } public function construct() { parent::construct(); $this->defaults['PACKET'] = Search_Api::PACKET_ONLY_HOTELS; } public function getSTATEFROM() { return $this->api()->getSTATEFROM(); } } 