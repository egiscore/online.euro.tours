"use strict";(function($){var container=samo.initModuleContainer('agencies');samo.agencies=function(){var $module_container=container,ROOT_URL=samo.ROUTES.agencies.url,loadBtn=$module_container.find('.load');var controls=samo.cache_controls($module_container,'.QUERY,.METROSTATION,.TOWN,.resultset,input[name=embed]');$(controls.TOWN).chosen({allow_single_deselect:true,enable_split_word_search:false,search_contains:true}).bind('change',function(){var params={samo_action:'TOWN',TOWN:this.value};if(controls.embed){params.embed=$(controls.embed).val();}
var url=ROOT_URL+$.param(params);$.getScript(url,function(){},true);});$(controls.METROSTATION).chosen({allow_single_deselect:true,enable_split_word_search:false,search_contains:true});loadBtn.bind('click',function(){var params={samo_action:'SEARCH'};var query=$(controls.QUERY).val();if(query.length){params.QUERY=query;}
var town=parseInt($(controls.TOWN).val())||0;if(town>0){params.TOWN=town;var metrostation=parseInt($(controls.METROSTATION).val())||0;if(metrostation>0){params.METROSTATION=metrostation;}}
if(Object.keys(params).length>1){if(controls.embed){params.embed=$(controls.embed).val();}
$.getScript(ROOT_URL+$.param(params));}else{$(controls.QUERY).errorField(samo.LANG.NOT_SET_AGENCY_INFO);}});$(controls.resultset).delegate('.link','click',function(){var params={samo_action:'SHOW',PARTNER:$(this).parents('tr').data('partner')};if(controls.embed){params.embed=$(controls.embed).val();}
$.getScript(ROOT_URL+$.param(params));});$(controls.QUERY).bind('keypress',function(e){if(e.keyCode==13){loadBtn.triggerHandler('click');}});};$(document).bind('ready',samo.agencies);})(samo.jQuery);