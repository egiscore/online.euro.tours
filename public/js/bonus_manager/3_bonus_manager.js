
(function($){samo.bonus_manager=function(){var $module_container=$('#bonus_manager');$module_container.find('.toggle_detail').bind('click',function(){var self=this,$detail=$(self).parent().find('.detail');if($detail.is(':visible')){$detail.slideUp(function(){$(self).text($(self).data('show'))});}else{$detail.slideDown(function(){$(self).text($(self).data('hide'));});}}).end().find('.claiminfo').bind('click',function(e){e.preventDefault();$.getScript(samo.ROOT_URL+$.param({samo_action:'CLAIM_DESCRIPTION',CLAIM:$(this).data('claim')}));}).end().find('.bonus_use').bind('click',function(){var confirm_text=$module_container.data('use-confirm');if(check_fields()&&confirm(confirm_text)){var result={};result.CLAIM=parseInt($('#pay_variant').data('claim'));result.AMOUNT=parseFloat($module_container.find('.MAX_AMOUNT').val());$.post(samo.ROUTES.bonus_manager.url+$.param({samo_action:'USE_BONUS'}),result,null,false);}}).end().find('.MAX_AMOUNT').bind('keypress',samo.key_press_filter).bind('blur',check_fields);function check_fields(){var is_ok=true;if(is_ok){var $fld=$module_container.find('.MAX_AMOUNT');if($fld.length>0){var real_value=$fld.val(),value=parseFloat(real_value);if(value!=real_value){$.notify(samo.i18n('NO_CLAIM_PAYMENT'));is_ok=false;}
if(is_ok&&value<=0){$.notify(samo.i18n('NO_CLAIM_PAYMENT'));is_ok=false;}
if(is_ok){var max_value=parseFloat($fld.data('max'));if(value>max_value){$.notify(samo.i18n('PAYER_AMOUNT_BIG')+' '+max_value);$fld.val(max_value);return false;}}}}
return is_ok;}};$(document).ready(samo.bonus_manager);})(samo.jQuery);