
(function($){samo.claim_unpaid=function(){var clasname='blue';$('.claiminfo').bind('click',function(e){e.preventDefault();$.getScript(samo.ROUTES.claim_unpaid.url+$.param({samo_action:'CLAIM_DESCRIPTION',CLAIM:$(this).data('claim')}));});$('#bpay').bind('click',function(){var result={};if($('#deposit_claims tr').length==0){$.notify(samo.i18n('DEPOSIT_NOT_CHOOSE_CLAIM'));return;}
var claims=[];$('#deposit_claims tr').each(function(){claims.push({claim:$(this).data('claim'),debt:$(this).data('debt')});});result.CLAIMS=claims;$.post(samo.ROUTES.deposit.url+$.param({samo_action:'USE_DEPOSIT',PINC:$('#deposit_sum').data('deposit_inc')}),result,paySuccess,'script');});function paySuccess(){if(samo.pay_success){$('#claims input.want_pay:checked').each(function(){$(this).prop('checked',false).attr('disabled',true);$(this).parent().addClass('line_through');$(this).parents('tr:first').removeClass(clasname);$('#deposit_claims tr').remove();var deposit_sum_now=$('#deposit_sum').data('deposit_sum_now');var deposit_currency_alias=$('#deposit_sum').data('deposit_currency_alias');if(deposit_sum_now<0){deposit_sum_now=0;}
$('#deposit_sum_orig_th').html(deposit_sum_now+'&nbsp;'+deposit_currency_alias);$('#deposit_sum').parent().addClass('hidden');$('#bpay').parents('tr:first').addClass('hidden');});}
samo.pay_success=false;}
$('#claim_unpaid .want_pay').bind('click',function(e){var srcElement=e.target.tagName.toUpperCase();var $label=(srcElement=='LABEL')?$(e.target):(srcElement=='INPUT')?$(e.target).parent():false;var $input=$label.find('input');var checked=$input.is(':checked');var deposit_sum_now=parseFloat($('#deposit_sum').data('deposit_sum_now'));if(deposit_sum_now>0||!checked){if(!checked){$input.parents('tr:first').removeClass(clasname);}
var tbody='';var deposit_total=parseFloat($('#deposit_sum').data('deposit-sum-orig'));var deposit_currency_alias=$('#deposit_sum').data('deposit_currency_alias');$('#deposit_claims').html('');$('#claims input.want_pay:checked').each(function(){if(deposit_total>0){var claim=$(this).parents('tr:first').data('claim');var claim_sum=parseFloat($(this).parents('tr:first').data('tour-debt'));var deposit_claim_sum=claim_sum;var partpayment='&nbsp;';if(deposit_total-claim_sum<0){deposit_claim_sum=deposit_total;partpayment='<span class="red">'+samo.i18n('CLAIM_AMOUNT_OF_DEBT')+'</span><br>'+(claim_sum-deposit_claim_sum).toFixed(2)+'&nbsp;'+deposit_currency_alias}
deposit_total=(deposit_total-claim_sum).toFixed(2);$('#deposit_claims').append('<tr id="d_claim_'+claim+'" data-claim="'+claim+'" data-debt="'+deposit_claim_sum+'"><td>'+samo.i18n('DEPOSIT_CLAIM')+claim+'</td><td>'+deposit_claim_sum+'&nbsp;'+deposit_currency_alias+'</td><td>'+partpayment+'</td></tr>');$(this).parents('tr:first').addClass(clasname);}else{$(this).parents('tr:first').removeClass(clasname);$(this).prop('checked',false);}});$('#deposit_sum').data('deposit_sum_now',deposit_total);if(deposit_total<0){deposit_total=0;}
var tmp=deposit_total+'&nbsp;'+deposit_currency_alias;$('#deposit_sum').html(tmp);$.notify(samo.i18n('DEPOSIT_CURRENT_SUM')+' '+tmp);if($('#deposit_claims tr').length==0){$('#deposit_sum').parent().addClass('hidden');$('#bpay').parents('tr:first').addClass('hidden');}else{$('#deposit_sum').parent().removeClass('hidden');$('#bpay').parents('tr:first').removeClass('hidden');}}else{$.notify(samo.i18n('DEPOSIT_LESS_SUMM'));$(this).prop('checked',false);}});};$('.EARLYCOMISSION,.NEARFUTURE').chosen({disable_search:true});$(document).ready(samo.claim_unpaid);})(samo.jQuery);