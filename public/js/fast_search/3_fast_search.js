
(function($){var container=samo.initModuleContainer('fast_search');samo.fast_search=function(){var $module_container=container,_controls=samo.cache_controls($module_container,'select,input'),_ROOT_URL=samo.ROUTES.fast_search.url;var chosenControls='.TOWNFROMINC,.STATEINC,.TOURINC,.HOTELS,.STARS,.ADULT,.NIGHTS_FROM,.NIGHTS_TILL,.CHILD,.CURRENCY';$(chosenControls).each(function(){var disable_search=false,$this=$(this);if($this.hasClass('ADULT')||$this.hasClass('NIGHTS_FROM')||$this.hasClass('NIGHTS_TILL')||$this.hasClass('CHILD')||$this.hasClass('CURRENCY')){disable_search=true;}
$this.chosen({enable_split_word_search:false,search_contains:true,disable_search:disable_search});var chosenEl=$this.parent().find('.chosen-container');chosenEl.addClass($this.attr('name')+'_chosen');chosenEl.css('text-align','left').css('width','100%');});samo.controls.HOTELINC=samo.controls.HOTELS;if(typeof $module_container.attr('embed')!='undefined'){var embedable='embed_'+$module_container.attr('embed');samo.controls[embedable].CHECKIN_BEG=$module_container.find('.CHECKIN_BEG').get(0);}
samo.controls.CHECKIN_BEG=$module_container.find('.CHECKIN_BEG').get(0);$module_container.find('.TOWNFROMINC,.STATEINC,.TOURINC,.STARINC.ADULT,.CHILD').bind('change',function(){var name=this.name||$(this).attr('name');if(name=='TOWNFROMINC'||name=='STATEINC'){$module_container.find('.TOURINC option[value=0]').prop('selected',true);}
if($.controlValue(name,false,$module_container)){$.getScript(getParams(name),function(){samo.blink_element();},true);}}).end().find('.STARS').bind('change',function(){$.getScript(getParams('STARS'),function(){samo.blink_element();},true);}).end().find('input[name=PACKET]:visible:first').prop('checked',true).end().find('input.date').datePicker().end().find('input.price').numeric().SpinButton({step:100,min:0});$module_container.find('.CURRENCY').bind('change',function(){var $currency_to=$(this).val();$module_container.find('input[name=COSTMAX]').each(function(){if($(this).val()){var exrate=($(this).data('samo-currency')!=$currency_to)?samo.CROSS_RATES[$(this).data('samo-currency')][$currency_to]:1;var newValue=Math.ceil(parseInt($(this).data('samo-value'))*exrate);$(this).val(newValue).triggerHandler('blur');}});});$module_container.find('input[name=COSTMAX]').bind('blur',function(){var currency=$module_container.find('.CURRENCY option:selected').val(),value=$(this).val();$(this).data('samo-value',value).data('samo-currency',currency);});$module_container.find('.NIGHTS_FROM').bind('change',function(){$(samo.controls.NIGHTS_TILL).val(this.value);});$module_container.find('.NIGHTS_TILL').bind('change',function(){var $night_from=$module_container.find('.NIGHTS_FROM');if($night_from.length)
if(parseInt(this.value)<parseInt($night_from.val())){$night_from.val(this.value);}});function getParams(action){var useGET=false;var result={};result.samo_action=action;$.each(_controls,function(){var name=this.name||$(this).attr('name')||$(this).data('name');var value=$.controlValue(this,useGET);if(name){var add=true;if(action=='INIT'&&$.inArray(name,['STATEINC','HOTELS','CHECKIN_BEG','ADULT','CHILD','NIGHTS_FROM','NIGHTS_TILL','embed'])<0){add=false;}else{if(action=='TOWNFROMINC'&&$.inArray(name,['TOWNFROMINC','CHECKIN_BEG','ADULT','CHILD','NIGHTS_FROM','NIGHTS_TILL','embed'])<0){add=false;}else if(action=='STATEINC'&&$.inArray(name,['TOWNFROMINC','STATEINC','CHECKIN_BEG','ADULT','CHILD','NIGHTS_FROM','NIGHTS_TILL','embed'])<0){add=false;}else if($.inArray(action,['TOURINC','STARS','ADULT','CHILD'])+1&&$.inArray(name,['TOWNFROMINC','STATEINC','TOURINC','HOTELS','STARS','CHECKIN_BEG','ADULT','CHILD','NIGHTS_FROM','NIGHTS_TILL','embed'])<0){add=false;}}
if(add){result[name]=value;}}
var copyto=$(this).data('copyto');if(copyto){$.each(copyto.split(','),function(){$module_container.find('#'+this).val(value);});}});result.mode=(arguments.length==2)?arguments[1]:$module_container.hasClass('search_tour')?'search_tour':'search_hotel';return _ROOT_URL+$.param(result);}
var $frm=$module_container.find('#fast_search_frm');function getPriceURL(e){if(samo.checkStateAndTownfrom($module_container)){if((($(samo.controls.NIGHTS_FROM).length&&!$.controlValue('NIGHTS_FROM'))||($(samo.controls.NIGHTS_TILL).length&&!$.controlValue('NIGHTS_TILL')))&&$.radioValue('PACKET')!=1){$.notify({text:samo.i18n('NO_NIGHTS'),type:'error'});}else{var action=$frm.attr('action');var url=samo.parseURL(action);url.params._=Number(new Date);$.each(url.params,function(param,value){var $input=$frm.find('[name='+param+']');if(!$input.length){$frm.append('<input type="hidden" name="'+param+'" value="'+value+'">');}else if('_'==param){$input.val(value);}});getParams();return true;}}
e.preventDefault();e.stopPropagation();return false;}
$frm.bind('submit',getPriceURL);$module_container.find('.load').bind('click',getPriceURL);samo.blink_element();samo.fast_mode=function(mode){var new_mode='search_'+mode;if(!container.hasClass(new_mode)){$.getScript(getParams('INIT',new_mode)+'&is_js=1',function(){if(mode=='tour'){container.removeClass('search_hotel').addClass('search_tour');}else{container.removeClass('search_tour').addClass('search_hotel');}
container.find('input[name="page"]').val(new_mode).end().find('#fast_search_frm').attr('action',samo.ROUTES[new_mode]['url']);},true);}};var $search_tabs=$module_container.find('.searchmodes .searchmode').not('.searchmode_ticket').html(function(){return'<a class="searchmode_button" href="javascript:samo.fast_mode(\''+$(this).data('searchmode')+'\')">'+$(this).text()+'</a>';});$search_tabs.removeClass('searchmode_selected');};$(document).ready(samo.fast_search);})(samo.jQuery);