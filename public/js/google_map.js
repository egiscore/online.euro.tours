
(function($){samo.googlemap=function($module_container){var mapContainer=$module_container.find('.map_container');if(mapContainer.length){if(mapContainer.attr('data-map-options').length){options=mapContainer.data('map-options');if(options.key.length){var addressField=$module_container.find("input[name*='[PARTNER_ADDRESS]']");addressField.parent().append('<a href="#" id="showMap">'+samo.i18n('MARK_ON_MAP')+'</a>');$module_container.find("#showMap").click(function(){var modalSettings={width:768,height:580};$.modal('<div class="googleMap">'+$module_container.find(".googleMapWindow").html()+'</div>'+'<p>'+samo.i18n('MOVE_THE_MARKER_TO_MATCH_YOUR_ADDRESS')+'</p>'+'<div class="closeMapButton"><button class="modalClose">'+samo.i18n('SAVE_AND_CLOSE')+'</button></div>',{width:parseInt(modalSettings.width)+20,height:parseInt(modalSettings.height)+20,title:samo.i18n('ADDRESS_MARKING_ON_THE_MAP')});samo.Map($module_container);return false;});}}}
samo.Map=function($module_container){var container=$module_container.find('.map_container');options=container.data('map-options');var googleContainer=$('#basicModalContent').find('.googleMap');var map=null;samo.initMap=function(){var latField=$module_container.find('input[name*="[PARTNER_GEOLAT]"]');var lonField=$module_container.find('input[name*="[PARTNER_GEOLON]"]');var addressField=$module_container.find('input[name*="[PARTNER_ADDRESS]"]');var cityField=$module_container.find('select[name*="[PARTNER_TOWN]"] option:selected');if(!cityField.length){cityField=$module_container.find('span[data-frm-name*="[PARTNER_TOWN]"]');}
var serachAddress=cityField.text()+', '+addressField.val();geocoder=new google.maps.Geocoder();geocoder.geocode({'address':serachAddress},function(results,status){if(latField.val().length&&lonField.val().length){options.latitude=latField.val();options.longitude=lonField.val();}else if(status==='OK'&&serachAddress.length){options.latitude=results[0].geometry.location.lat();options.longitude=results[0].geometry.location.lng();}
latField.val(options.latitude);lonField.val(options.longitude);var point=new google.maps.LatLng(options.latitude,options.longitude);var mapOptions={center:point,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(googleContainer[0],mapOptions);var marker=new google.maps.Marker({position:point,map:map,draggable:true});google.maps.event.addListener(marker,'dragend',function(){var pointer=marker.getPosition();latField.val(pointer.lat());lonField.val(pointer.lng());});});return workhorse=google.maps;};if(typeof workhorse=='undefined'){$.getScriptReal("//maps.googleapis.com/maps/api/js?key="+options.key+"&sensor=false&&callback=samo.initMap");}else{samo.initMap();}};};})(samo.jQuery);