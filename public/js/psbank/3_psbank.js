
(function($){samo.psbank=function(){var $module_container=$('#psbank'),$form=$('#PSBANK_FORM');samo.set_data_mask($module_container);samo.helpalt_field($module_container);$module_container.find('input.date').datePicker({direction:false});$module_container.find('input.date[name*=PAYER_BORN]').datePicker({start_date:samo.dateYearAgo(-30),direction:false});samo.psbankButtonShow=function(){$('button.load').show();$('.progressbar').remove();};$module_container.find('.load').bind('click',function(){if(check_fields()){var action=$form.attr('action');var _ROOT_URL=samo.ROUTES.psbank.url;var result=$form.serializeArray();var $link=$('<a/>');$link.attr('href',action).css('display','none').data('post-form',$form).appendTo(psbank);$link.bind('click',samo.delayed_download).triggerHandler('click');$link.removeData('post-form');$('button.load').hide();}
return false;}).end().find('.PAYER').bind('change',function(){var payer_inc=this.value;var $values=(payer_inc>0)?$('option:selected',this).data('payer'):{PAYER_FIO:"",PAYER_ADDRESS:"",PAYER_PSERIE:"",PAYER_PNUMBER:"",PAYER_PGIVENDATE:"",PAYER_PGIVENORG:"",PAYER_PGIVENORG_MENT:"",PAYER_BORN:"",PAYER_PHONES:""};var update_warrant=$module_container.data('update_warrant');$.each($values,function(idx,value){var tmp=$('.'+idx);tmp.val(value||'');if(update_warrant==0&&payer_inc>0&&value!=''){tmp.prop('readonly',1);}else{tmp.prop('readonly',0);}
var $warning=$module_container.find('.warning');if(update_warrant==0&&payer_inc>0){$warning.css('display','block');}else{$warning.css('display','none');}});}).triggerHandler('change');$('[name=MAX_AMOUNT_LABEL]',$module_container).bind('click',function(){$('#MAX_AMOUNT').val($.radioValue('MAX_AMOUNT_LABEL'));}).triggerHandler('click');function check_fields(){var is_ok=true;samo.field.clear_errors($form);$form.find('.required').not('label').each(function(){if(!$(this).val().length){is_ok=samo.field.error(samo.i18n('REQUIRED_FIELD_EMPTY'),this);}});if(is_ok){$form.find('.date').each(function(){if(this.value.length&&!$.valid_date(this)){is_ok=samo.field.error(samo.i18n('DATE_FORMAT_TITLE'),this);return false;}});}
if(is_ok){var fld='[name=MAX_AMOUNT]',$fld=$(fld);if($fld.length>0){var tmp=parseFloat($fld.val());if(tmp!=$fld.val()){$fld.errorField(samo.i18n('INVALID_PAYER_AMOUNT'));return false;}
if(tmp==0){$fld.errorField(samo.i18n('NO_CLAIM_PAYMENT'));return false;}
var tmp2=parseFloat($fld.attr('max'));if(tmp>tmp2){$fld.errorField(samo.i18n('PAYER_AMOUNT_BIG')+' '+$(fld).attr('max'));$fld.val(tmp2);return false;}}
$fld=$('#BANK');if($fld.val()==0){$fld.errorField(samo.i18n('PSBANK_BANK'));return false;}}
return is_ok;}};})(samo.jQuery);