'use strict';(function($){var container=samo.initModuleContainer('reports');var _ROOT_URL=samo.ROUTES.reports.url,$module_container=container;samo.reports=function(){var $btn=$module_container.find('button.getReport');$module_container.find('.downloadLinkBlock').delegate('a.getReport','click',function(e){var $link=$(this);if(!$link.attr('download')){$link.data('post-form','.reportForm');samo.delayed_download(e);$link.removeData('post-form');var timer=setInterval(function(){var dnl=$module_container.find('a.getReport.in-progress');if(!dnl.length){clearInterval(timer);$btn.prop('disabled',false).css('display','block');}},250);return false;}});$btn.click(function(){if(validateForm()){$btn.prop('disabled',true);var $link=$module_container.find(".downloadLinkBlock a.getReport");$link.html(samo.i18n('GENERATE_A_REPORT')).attr('href',$module_container.find('.reportForm').attr('action')).removeAttr('download').removeData();$link.show().click();}});$module_container.find('.selectReport').bind('change',getReportParamsByTemplate);function getReportParamsByTemplate(){var template=parseInt(this.value);if(template){getReportParams(template);}else{$module_container.find(".reportParams").empty();$btn.hide();}
return false;}
function validateForm(){var status=true;$module_container.find('.reportParams .required').not('label, :disabled').each(function(){if(!$.NonEmptyValue(this)){status=false;return status;}});return status;}
function hideDownloadLink(){$module_container.find('a.getReport').removeAttr('download').removeClass('samo-delayed-download').html('');}
samo.initReportForm=function(){if($module_container.find('.reportForm').length){$module_container.find('.date').datePicker().end().find('.reload').bind('change',function(){$.post(_ROOT_URL+'samo_action=reloadReportParams',$module_container.find('.reportForm').serialize());});$module_container.find('input,select').bind('change',hideDownloadLink);hideDownloadLink();$btn.prop('disabled',false).css('display','block');}};function getReportParams(template){$.getScript(_ROOT_URL+
$.param({template:template,samo_action:'getReportParams'}));}
samo.initReportForm();if(parseInt(samo.parseURL(window.location.href).params.DOLOAD)==1){$btn.click();}};$(document).ready(samo.reports);})(samo.jQuery);