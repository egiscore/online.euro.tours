
(function($){var container=samo.initModuleContainer('search_tour');var price_url=null;var _ROOT_URL=samo.ROOT_URL;var $module_container=container;samo.search_tour=function(){var DOLOAD=(parseInt($.getParameter('DOLOAD',true,$module_container))==1);var _controls=samo.cache_controls($module_container,'.STATEFROM,.STATEINC,.TOWNFROMINC,.TOURINC,.PROGRAMGROUPINC,.PROGRAMINC,.TOWNS,.HOTELS,.STARS,.MEALS,.ROOMS,.CURRENCY,.NIGHTS_FROM,.NIGHTS_TILL,.ADULT,.CHILD,.FILTER,.FREIGHT,.MOMENT_CONFIRM,.CHILD_IN_BED,.COSTMIN,.COSTMAX,.CHECKIN_BEG,.CHECKIN_END,.HOTELSSEL,.TOURTYPE,.INCOMINGPARTNER,.TOWNS_ANY,.STARS_ANY,.HOTELS_ANY,.MEALS_ANY,.ROOMS_ANY,.hotelsearch,input[name=embed],.UFILTER');var chosenControls='.TOWNFROMINC,.STATEFROM,.STATEINC,select.INCOMINGPARTNER,.TOURTYPE,.TOURINC,.PROGRAMGROUPINC,.PROGRAMINC,'+'.NIGHTS_FROM,.NIGHTS_TILL,.ADULT,.CHILD,.CURRENCY';$(this).find('option').each(function(){if($(this).attr('data-search-string')){$(this).attr('data-search-string',$(this).attr('data-search-string')+' '+$(this).attr('data-search-string').fixKeyboardLayout());}});$(chosenControls).each(function(){var disable_search=true,chosenEl;if($(this).hasClass('TOWNFROMINC')||$(this).hasClass('STATEFROM')||$(this).hasClass('STATEINC')||$(this).hasClass('INCOMINGPARTNER')||$(this).hasClass('TOURTYPE')||$(this).hasClass('TOURINC')||$(this).hasClass('PROGRAMGROUPINC')||$(this).hasClass('PROGRAMINC')){disable_search=false;}
$(this).chosen({enable_split_word_search:false,search_contains:true,disable_search:disable_search});chosenEl=$(this).parent().find('.chosen-container');chosenEl.addClass($(this).attr('name')+'_chosen');chosenEl.css('text-align','left').css('width','100%');});var $resultset=_controls.resultset=$module_container.find('.resultset');_controls.resultsetGrouped=$module_container.find('.resultsetGrouped');$.event.trigger('ajaxStart');var items={},HOTELS=_controls.HOTELS;$(HOTELS).find('input').each(function(i){var el=$(this),$gs=$.map(String(el.data('group-star')).split(','),function(e,i){return parseInt(e);}),$types=$.map(String(el.data('type')).split(','),function(e,i){return parseInt(e);});var item={inc:parseInt(this.value),title:' '+$.trim(el.parent().text().toLowerCase().replace(/[\x01-\x1F|\*]/g,' ')),town:parseInt(el.data('town')),GroupStarList:$gs,HotelTypeList:$types,ref:el.parent().get(0)};el.removeData('town').removeData('group-star').removeData('type');items[i]=item;});$.data($(HOTELS).get(0),'items',items);$module_container.find('.checklistbox :checked').each(function(){if(!this.defaultChecked){this.checked=false;}});$.event.trigger('ajaxStop');samo.price_helpers($module_container);var $incoming=$module_container.find('.incoming-slider');if($incoming.length){$incoming.find('.btn div').click(function(){var $lefty=$incoming.find('.panel');var hide=parseInt($lefty.css('margin-right'))==0;$lefty.animate({marginRight:hide?-155:0});if(hide){$module_container.find('.INCOMINGPARTNER input').prop('checked',false);$module_container.find('.INCOMINGPARTNER').change();$incoming.removeClass('open');}else{$incoming.addClass('open');}});}
var $prev_url=getParams('');$module_container.find('input.date').datePicker().end().find('input.price').numeric().SpinButton({step:100,min:0,max:10000000}).end().find('.STATEFROM,.TOWNFROMINC,.STATEINC').bind('change',function(){if(0!=$(this).val()){$module_container.find('.TOWNFROMINC,.STATEINC').find('option[value="0"]').remove();}
$module_container.find('.TOWNS_ANY,.MEALS_ANY,.STARS_ANY,.HOTELS_ANY').prop('checked',true).end().find('.TOWNS,.MEALS,.STARS,.HOTELS').empty().end().find('.HOTELSSEL').empty().removeClass('shown').end().find('.TOURINC,.PROGRAMGROUPINC,.PROGRAMINC,.TOURTYPE,.INCOMINGPARTNER').find('option').remove();}).end().find('.INCOMINGPARTNER,.TOURINC').bind('change',function(){if($(this).is('.INCOMINGPARTNER')){if($incoming.length){return true;}
$module_container.find('.TOURINC,.TOURTYPE').val(0);}
if($(this).is('.TOURTYPE')){$module_container.find('.TOURINC').val(0);}
$module_container.find('.TOWNS_ANY,.HOTELS_ANY').prop('checked',true).end().find('.TOWNS,.HOTELS').empty();}).end().find('.HOTELS_SEL').bind('click',function(){hotels_show(!this.checked);}).end().find('.STATEFROM,.TOWNFROMINC,.STATEINC,.TOURTYPE,.INCOMINGPARTNER,.TOURINC,.PROGRAMGROUPINC,.PROGRAMINC,.ADULT,.CHILD').bind('change',function(){var name=this.name||$(this).attr('name');setTimeout(function(){if('ADULT'!=name&&'CHILD'!=name){reset_hotels_filter();}
if(name!='STATEINC'||$.controlValue(name,false,$module_container)){if(name=='INCOMINGPARTNER'&&$incoming.length){var stamp=(new Date().getTime())+'-'+parseInt(Math.random()*10000);$incoming.data('stamp',stamp);setTimeout(function(){if(stamp==$incoming.data('stamp')&&$prev_url!=getParams('')){$module_container.find('.TOURINC,.TOURTYPE').val(0);$module_container.find('.TOWNS_ANY,.HOTELS_ANY').prop('checked',true).end();$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);}},1000);return true;}
$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);}},0);});$(_controls.HOTELS).bind('click',function(e){var srcElement=e.target.tagName.toUpperCase();var $label=(srcElement=='LABEL')?$(e.target):(srcElement=='INPUT')?$(e.target).parent():false;if($label){var $input=$label.find('input');var checked=$input.is(':checked');var $show_selected=$module_container.find('.HOTELS_SEL');if('LABEL'==srcElement){$input.get(0).checked=checked=!checked;e.preventDefault();e.stopPropagation();}
var selected_count=$module_container.find('.HOTELS input:checked').length;if($show_selected.is(':checked')){if(!checked){$label.addClass('hidden');}
if(selected_count==0){$show_selected.prop('checked',false);hotels_filter();}}
$module_container.find('.HOTELS_ANY').prop('checked',!checked&&selected_count==0);if(_controls.HOTELSSEL){var $el=$label.clone();$(_controls.HOTELSSEL).append($el).addClass('shown');if($.browser.msie){$el.find('input').prop('checked',true);}
$label.addClass('sel');}}});$(_controls.HOTELSSEL).delegate('label','click',function(){var $input=$(this).find('input'),$sel=$(_controls.HOTELSSEL);$(HOTELS).find('input[value='+$input.val()+']').prop('checked',false).parent().removeClass('sel');$(this).remove();if(!$sel.find('input').length){$sel.removeClass('shown');$module_container.find('.HOTELS_ANY').prop('checked',true);}});$module_container.find('.STARS,.TOWNS').delegate('input','click',function(){var $groupbox=$(this).parents('div.groupbox');if($groupbox.length){if($(this).is('.group')){var inputs=$groupbox.find('input').not('.group').prop('checked',this.checked).parents('label');if(this.checked){inputs.removeClass('hidden');if(inputs.length>1){inputs.find('input').addClass('semiselected');}}else{inputs.addClass('hidden');if(inputs.length>1){inputs.find('input').removeClass('semiselected');}}}else{var $all=$groupbox.find('input').not('.group');if($(this).is('.semiselected')){$groupbox.find('.semiselected').removeClass('semiselected').prop('checked',false);$(this).prop('checked',true);}
var checked=$all.filter(':checked').length;if($all.length==checked||checked==0){$groupbox.find('input.group').prop('checked',checked>0);if(0==checked){$groupbox.find('label').not('.groupname').addClass('hidden');}}}}
hotels_filter();}).end().find('.MEALS,.ROOMS,.UFILTER').checklistbox().end().find('.CURRENCY').bind('change',function(){var $currency_to=$(this).val();$module_container.find('input[name=COSTMAX],input[name=COSTMIN]').each(function(){if($(this).val()){var exrate=($(this).data('currency')!=$currency_to)?samo.CROSS_RATES[$(this).data('currency')][$currency_to]:1;var newValue=Math.ceil(parseInt($(this).data('value'))*exrate);newValue=isNaN(newValue)?'':newValue;$(this).val(newValue).triggerHandler('blur');}});}).end().find('input[name=COSTMAX],input[name=COSTMIN]').bind('blur',function(){var currency=$module_container.find('.CURRENCY option:selected').val(),value=$(this).val();$(this).data('value',value).data('currency',currency);}).end().find('.CHECKIN_BEG').bind('change.datepicker',function(){$(_controls.CHECKIN_END).val(this.value);}).end().find('.CHECKIN_BEG, .CHECKIN_END').bind('change.datepicker',function(){var name=this.name||$(this).attr('name');var $nights=$module_container.find('.NIGHTS_TILL, .NIGHTS_FROM');$nights.prop('disabled',true).trigger('chosen:updated');$.getScript(getParams(name),function(){samo.blink_element();$nights.prop('disabled',false).trigger('chosen:updated').trigger('chosen:activate');},true);}).end().find('.NIGHTS_FROM').bind('change',function(){$(_controls.NIGHTS_TILL).val(this.value);$(_controls.NIGHTS_TILL).trigger('chosen:updated');}).end().find('.NIGHTS_TILL').bind('change',function(){if(parseInt(this.value)<parseInt(_controls.NIGHTS_FROM.value)){$(_controls.NIGHTS_FROM).val(this.value);$(_controls.NIGHTS_FROM).trigger('chosen:updated');}}).end().find('input[name=PACKET]').bind('click',function(){if($module_container.find('.NOHOTELS').is(':checked')){$module_container.find('.HOTELSCONTAINER').addClass('hidden');}else{$module_container.find('.HOTELSCONTAINER').removeClass('hidden');}}).end().find('.CHILD').bind('draw_child_ages',function(){var $childAges=$module_container.find('.child_ages');if(this.value>0&&this.value<=3){$childAges.css('visibility','visible');var chDestroy=[];for(var $i=1;$i<=3;$i++){if($i<=this.value){$module_container.find('.age_'+$i).css('visibility','visible').chosen({enable_split_word_search:false,search_contains:true,disable_search:true}).parent().find('.chosen-container:eq('+($i-1)+')').css('width','53px');}else{$module_container.find('.age_'+$i).css('visibility','hidden');if($module_container.find('.age_'+$i).parent().find('.chosen-container:eq('+($i-1)+')').length){chDestroy.push($i);}}}
for(var i=0;i<chDestroy.length;i++){$module_container.find('.age_'+chDestroy[i]).chosen('destroy');}}else{$childAges.css('visibility','hidden').find('.age').css('visibility','hidden');}}).bind('change',function(){$(this).triggerHandler('draw_child_ages');}).end().find('.hotelsearch').bind('keyup',function(e){if(e.keyCode==27){$(this).trigger('clearSearch');e.stopPropagation();return;}
$module_container.find('.HOTELS_SEL').data('checked',false);hotels_filter();}).bind('mouseup',function(){var $input=$(this),oldValue=$input.val();if(oldValue==''){return;}
setTimeout(function(){var newValue=$input.val();if(newValue==''){$input.trigger("clearSearch");}});}).bind('clearSearch',function(){this.value='';hotels_filter();});if($module_container.find('.NOHOTELS').is(':checked')){$module_container.find('.HOTELSCONTAINER').addClass('hidden');}
$module_container.find('.child_ages .age').numeric(' ').attr('title',samo.i18n('CHILD_AGES'));if(_controls.CHILD.value>0){$(_controls.CHILD).triggerHandler('change');}
$module_container.find('.load').bind('click',getPrices);$(_controls.CURRENCY).bind('change',price_page_url);function getPrices(){if(!samo.checkStateAndTownfrom($module_container)){return false;}
if($.controlValue('ADULT')+$.controlValue('CHILD')==0){$.notify({text:samo.i18n('CHOOSE_PEOPLE_COUNT'),type:'error'});return false;}
if((parseInt($.controlValue('NIGHTS_FROM'))+parseInt($.controlValue('NIGHTS_TILL')))==0&&$.radioValue('PACKET')!=1){$.notify({text:samo.i18n('NO_NIGHTS'),type:'error'});return false;}
if($(HOTELS).find('input:checked').length==0&&$(HOTELS).find('label').not('.hidden').length==0&&!$module_container.find('.NOHOTELS').is(':checked')){$.notify({text:samo.i18n('NO_HOTEL'),type:'error'});return false;}
$.getScript(price_page_url()+'1',true);}
function price_page_url(){price_url=getParams('PRICES')+'&PRICEPAGE=';return price_url;}
function getParams(action){var useGET=arguments[1]||false;var returnObj=arguments[2]||false;var params={};params.samo_action=action;$.each(_controls,function(i,v){var name=v.name||$(v).attr('name');if(!name){return;}
if(!(1+$.inArray(action,['TOWNFROMINC','STATEINC','TOURTYPE','INCOMINGPARTNER','TOURINC','PROGRAMGROUPINC','PROGRAMINC','ADULT','CHILD','CHECKIN_BEG','CHECKIN_END']))||(1+$.inArray(name,['STATEFROM','TOWNFROMINC','STATEINC','TOURTYPE','INCOMINGPARTNER','TOURINC','PROGRAMGROUPINC','PROGRAMINC','NIGHTS_FROM','NIGHTS_TILL','ADULT','CHILD','CHECKIN_BEG','CHECKIN_END','CHILD','embed']))){if(action=='TOWNFROMINC'&&$.inArray(name,['STATEINC','TOURINC','PROGRAMGROUPINC','PROGRAMINC','TOURTYPE','INCOMINGPARTNER'])+1){return;}else if(action=='STATEINC'&&$.inArray(name,['TOURINC','PROGRAMGROUPINC','PROGRAMINC','TOURTYPE','INCOMINGPARTNER'])+1){return;}else if($.inArray(action,['TOURTYPE','INCOMINGPARTNER'])+1&&$.inArray(name,['TOURINC','PROGRAMGROUPINC','PROGRAMINC'])+1){return;}
if(name=='COSTMAX'||name=='COSTMIN'){var val=$.controlValue(v,useGET);if(val){params[name]=val;}}else{params[name]=$.controlValue(v,useGET);}}});if($.inArray(action,['TOWNFROMINC','STATEINC','TOURINC','PROGRAMGROUPINC','PROGRAMINC','TOURTYPE','INCOMINGPARTNER','ADULT','CHILD','CHECKIN_BEG','CHECKIN_END'])<0){var stars=[],hoteltypes=[];$('.STARS',$module_container).find('input:checked').each(function(){if($(this).is('.star')){stars.push(parseInt($(this).val()));}else{if($(this).is('.hoteltype')){hoteltypes.push(parseInt($(this).val()));}}});params.STARS=stars.join(",");params.HOTELTYPES=hoteltypes.join(",");if(!params.MEALS){var value=$.getParameter('MEALINC',1,$module_container);if(value){params.MEALINC=value;}}
if(!params.ROOMS){var value=$.getParameter('ROOMINC',1,$module_container);if(value){params.ROOMINC=value;}}
params.PACKET=$.radioValue('PACKET')||0;if(params.CHILD>0&&params.CHILD<=3){var ages=[],age=0;for(var idx=1;idx<=params.CHILD;idx++){age=$module_container.find('.child_ages').find('.age_'+idx).val();ages.push(parseInt(age));}
params.AGES=ages.sort(function(a,b){return a-b;}).join(',');}
var partPriceEl=$module_container.find('input.PARTITION_PRICE');var partPrice=partPriceEl.prop('checked')?partPriceEl.val():null;params.PARTITION_PRICE=partPrice;}
return returnObj?params:_ROOT_URL+$.param(params);}
samo.price_clickable($module_container);$resultset.delegate('span.page','click',function(){$.getScript(price_url+$(this).data('page'),true);});samo.initResultset=function(){var $legend=$module_container.find('.price_legend').show();var $scrollTo=$module_container.find('#scrollto');var offset=($scrollTo.length?$scrollTo:$legend).offset();window.scrollTo(offset.left,offset.top);var pager=$module_container.find('div.pager');$resultset.delegate('span','mouseover',function(){var $self=$(this);if($self.is('.paymentschedule'))$self.attr('title',samo.i18n('PAYMENT_SCHEDULE_TITLE'));if($self.is('.recommend'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_RECOMENDED'));if($self.is('.vip'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_VIP'));if($self.is('.best'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_THE_BEST'));if($self.is('.surcharge'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_SURCHARGE'));if($self.is('.surchargeIn'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_SURCHARGE_IN'));if($self.is('.surchargeOut'))$self.attr('title',samo.i18n('TOUR_SEARCH_PRICE_SURCHARGE_OUT'));});if(samo.ROUTES.all_prices){$('table.res').delegate('span.all_prices','click',function(){var params={},$data=$(this).parents('tr:first').data();params.TOWNFROMINC=$data.townfrom;params.STATEINC=$data.state;params.CATCLAIM=$data.catClaim;params.CURRENCY=$(_controls.CURRENCY).val();window.open(samo.ROUTES.all_prices.url+$.param(params),'all_prices'+params.HOTELINC);});}
$(_controls.resultset).find('table.res').delegate('span.additional','click',function(){var params={samo_action:'CONTENT'},$data=$(this).parents('tr:first').data();params.TOWNFROMINC=$data.townfrom;params.STATEINC=$data.state;params.CATCLAIM=$data.catClaim;if(_controls.embed){params.embed=$(_controls.embed).val()}
$.getScript(_ROOT_URL+$.param(params));}).delegate('span.percent','click',function(){var params={samo_action:'COMMISSIONS'},$data=$(this).parents('tr:first').data();params.TOWNFROMINC=$data.townfrom;params.STATEINC=$data.state;params.CATCLAIM=$data.catClaim;params.CURRENCY=$(_controls.CURRENCY).val();if(_controls.embed){params.embed=$(_controls.embed).val()}
$.getScript(_ROOT_URL+$.param(params));}).delegate('span','click',function(){var $self=$(this),params={},$tr=$self.parents('tr:first'),$trdata=$tr.data();params.CATCLAIM=$trdata.catClaim;if($self.is('.paymentschedule')){params.samo_action='PAYMENTSCHEDULE';$.getScript(_ROOT_URL+$.param(params));}else if($tr.is('.stats')&&($self.is('.stats')||$self.is('.fr_place_l')||$self.is('.fr_place_r')||$self.is('.hotel_availability'))){params.samo_action='STATS';params.TOWNFROMINC=$trdata.townfrom;params.STATEINC=$trdata.state;params.CURRENCY=$(_controls.CURRENCY).val();$.getScript(_ROOT_URL+$.param(params),function(){if(typeof google=='undefined'){$.require('//www.gstatic.com/charts/loader.js',function(){google.charts.load('current',{packages:['corechart','bar'],language:samo.LANG.locale});google.charts.setOnLoadCallback(samo.googlePriceChart);samo.helpalt_field($('#search_stat'),'hover');});}else{samo.googlePriceChart();}});}});samo.helpalt_field(container,'hover');};if(DOLOAD){samo.initResultset();price_page_url();}
var hotels_filter=function(){var $grps=[],$twns=[],$hoteltypes=[],$all_towns=false;$module_container.find('.HOTELS_SEL').prop('checked',false);var towns_any=$module_container.find('.TOWNS_ANY').get(0);var category_any=$module_container.find('.STARS_ANY').get(0);var hotels=$(HOTELS).data('items');$(_controls.TOWNS).find('input:checked').each(function(){$twns.push(parseInt(this.value));});$all_towns=towns_any.checked=!$twns.length;$module_container.find('.STARS').find('input:checked').each(function(){if($(this).is('.star')){$grps.push(parseInt(this.value));}else{if($(this).is('.hoteltype')){$hoteltypes.push(parseInt(this.value));}}});category_any.checked=!$grps.length&&!$hoteltypes.length;var $filter=$.trim($(_controls.hotelsearch).val()).toLowerCase(),$strfilter=$filter.length;var is_ie=$.browser.msie;$.each(hotels,function(idx,$hotel){var found=($all_towns||$.inArray($hotel.town,$twns)!==-1);if(found&&$grps.length){found=false;$.each($hotel.GroupStarList,function(_idx,$grp){if($.inArray($grp,$grps)!==-1){return found=true;}});}
if(found&&$hoteltypes.length){found=false;$.each($hotel.HotelTypeList,function(_idx,$hoteltype){if($.inArray($hoteltype,$hoteltypes)!==-1){return found=true;}});}
if(found&&$hoteltypes.length){found=false;$.each($hotel.HotelTypeList,function(_idx,$hoteltype){if($.inArray($hoteltype,$hoteltypes)!==-1){return found=true;}});}
if(found&&$hoteltypes.length){found=false;$.each($hotel.HotelTypeList,function(_idx,$hoteltype){if($.inArray($hoteltype,$hoteltypes)!==-1){return found=true;}});}
if(found&&$strfilter){found=$hotel.title.indexOf($filter)>0;}
var $label=$hotel.ref;if(found){$label.classList.remove('hidden');if(is_ie){$label.style.zoom=1;}}else{$label.classList.add('hidden');}});};var reset_hotels_filter=function(){$module_container.find('.TOWNS_ANY,.STARS_ANY').each(function(){this.checked=true;var name=this.name.replace(/_ANY/,'');$module_container.find('.'+name+' :checked').prop('checked',false);});$(_controls.hotelsearch).val('');};var hotels_show=function(show_all){show_all=show_all||false;if(show_all){hotels_filter();}else{reset_hotels_filter();var $hotels=$(_controls.HOTELS).find('input');$hotels.each(function(){this.parentNode.className=(this.checked)?'shown':'hidden';});}};samo.price_chart=function(){samo.price_clickable($('#chart-info'));var $chart=$('#chart');if(!$chart.length){return;}
var $charttip=$('#chart-tip'),$span=$charttip.find('span'),$chart_line_current=$('#chart-line-current');var $fixTop=85,$fixLeft=106;var $selected=$chart.find('img.blue_row');if($selected.length){var y=parseInt($selected.attr('height'))+parseInt($('#tr_chart_days').height())+parseInt($('#tr_chart_months').height());y+=6;$chart_line_current.css({display:'block',left:$fixLeft+16,top:-y});var $parent_selected=$selected.parent();var data=$parent_selected.data();var bron=$parent_selected.hasClass('bron');$('#chart-info table.res td.td_price .price').each(function(){$(this).html(data.price);if(bron){$(this).addClass('bron').addClass('price_button');}else{$(this).removeClass('bron').removeClass('price_button');}});}
$chart.delegate('td.info','mouseover',function(){var $img=$(this).find('img');var positions=$img.addClass('hover').position(),tip='',data=$(this).data(),diffint=parseInt(data.diff);var diff=(diffint==0||data.price==0)?'':(diffint>0?' <span class="plus">+'+data.diff+'</span>':' <span class="minus">'+data.diff+'</span>');var price=(data.price==0)?'':data.price;tip+='<b>'+data.datebeg+'</b><br>'+price+diff+'<br>';if($img.is('.red_row')){tip+='<span class="red_row">'+samo.i18n('TOUR_SEARCH_STOPSALE')+'</span>';}else if($img.is('.green_row')){tip+='<span class="green_row">'+samo.i18n('TOUR_SEARCH_MOMENT_CONFIRM')+'</span>';}else if($img.is('.pink_row')){tip+='<span class="pink_row">'+samo.i18n('TOUR_SEARCH_NO_TRANSPORT')+'</span>';}else{tip+='&nbsp;'}
$span.html(tip);$charttip.css({display:'block',top:positions.top-$fixTop,left:positions.left-$fixLeft});}).delegate('td.info','mouseout',function(){$(this).find('img').removeClass('hover');$charttip.css({display:'none'});}).delegate('td.refresh','click',function(){var $self=$(this)
var $data=$self.data();var $data_info=$('#chart-info').data();var params={};params.TOWNFROMINC=$data_info.townfrom;params.STATEINC=$data_info.state;params.CATCLAIM=$data.catClaim;params.CURRENCY=$data_info.currency;params.samo_action='STATS';$.getScript(_ROOT_URL+$.param(params));});};var do_filter=false;$module_container.find('.TOWNS_ANY,.STARS_ANY,.HOTELS_ANY,.MEALS_ANY,.ROOMS_ANY').bind('click',function(){var name=this.name.replace(/_ANY/,'');if(this.checked){$module_container.find('.'+name+' input:checked').prop('checked',false);if(name=='HOTELS'){$(_controls.hotelsearch).val('');$module_container.find('.HOTELS_SEL').prop('checked',false);$(_controls.HOTELSSEL).removeClass('shown').empty();$(_controls.HOTELS).find('.sel').removeClass('sel');}
if(name=='TOWNS'){$module_container.find('.TOWNS label').not('.groupname').addClass('hidden');}
hotels_filter();}else{if(0==$module_container.find('.'+name+' input:checked').length){this.checked=true;}}}).each(function(){var name=this.name.replace(/_ANY/,'');this.checked=!$module_container.find('.'+name+' input:checked').length;if(!do_filter&&!this.checked&&name!='MEALS'&&name!='ROOMS'){hotels_filter();do_filter=true;}});$module_container.find('.searchmodes .searchmode .searchmode_button').on('mousedown keypress',function(e){var $self=$(this),$parent=$self.parent(),params={};if(!$self.data('origHref')){$self.data('origHref',this.href);}
if('ticket'==$parent.data('searchmode')){params['CHILD']=$.controlValue(_controls['CHILD'],false,$module_container);params['ADULT']=$.controlValue(_controls['ADULT'],false,$module_container);params['CURRENCYINC']=$.controlValue(_controls['CURRENCY'],false,$module_container);params['CHECKIN']=$.controlValue(_controls['CHECKIN_BEG'],false,$module_container);var checkin=samo.dateFromString($.controlValue(_controls['CHECKIN_BEG'],false,$module_container),'yyyymmdd');var checkout=new Date();checkout.setTime(checkin.getTime());checkout.setDate(checkin.getDate()+$.controlValue(_controls['NIGHTS_FROM'],false,$module_container));params['CHECKOUT']=samo.dateAsString(checkout,'yyyymmdd');params['FREIGHTBACK']=1;params['YESPLACES']=$.controlValue(_controls['FREIGHT'],false,$module_container);}else{$.each(_controls,function(i,v){var name=v.name||$(v).attr('name');if(!name){return;}
if($.inArray(name,['STATEINC','TOWNFROMINC','TOURINC','INCOMINGPARTNER'])==-1){if(name=='COSTMAX'||name=='COSTMIN'){var val=$.controlValue(v,false);if(val){params[name]=val;}}else{params[name]=$.controlValue(v,false);}}});var stars=[],hoteltypes=[];$module_container.find('.STARS input:checked').each(function(){if($(this).is('.star')){stars.push(parseInt($(this).val()));}else{if($(this).is('.hoteltype')){hoteltypes.push(parseInt($(this).val()));}}});if(stars.length){params.STARS=stars.join(",");}
if(hoteltypes.length){params.HOTELTYPES=hoteltypes.join(",");}
if(!params.MEALS){var value=$.getParameter('MEALINC',1,$module_container);if(value){params.MEALINC=value;}}
if(!params.ROOMS){var value=$.getParameter('ROOMINC',1,$module_container);if(value){params.ROOMINC=value;}}}
if(params.CHILD){var $ages=[];$module_container.find('.child_ages .age').each(function(){if(this.value.length){$ages.push(parseInt(this.value));}});params.AGES=$ages.sort(function(a,b){return a-b;}).join(',');}
this.href=$self.data('origHref')+$.param(params);});if(_controls.HOTELSSEL){var $HOTELS=$(_controls.HOTELS);$HOTELS.find(':checked').each(function(){$HOTELS.triggerHandler($.Event("click",{target:this}));});}
samo.blink_element();samo.setDefaultAges=function(ages){var age1defaultValue=$module_container.find('.age_1').find('option').filter(function(){return this.defaultSelected;}).val();var age2defaultValue=$module_container.find('.age_2').find('option').filter(function(){return this.defaultSelected;}).val();var age3defaultValue=$module_container.find('.age_3').find('option').filter(function(){return this.defaultSelected;}).val();var age1=$module_container.find('.age_1');var age2=$module_container.find('.age_2');var age3=$module_container.find('.age_3');if(age1.val()==age1defaultValue&&age1.val()!=ages[0]){age1.val(ages[0]).trigger('chosen:updated');}
if(age2.val()==age2defaultValue&&age2.val()!=ages[1]){age2.val(ages[1]).trigger('chosen:updated');}
if(age3.val()==age3defaultValue&&age3.val()!=ages[2]){age3.val(ages[2]).trigger('chosen:updated');}};samo.groupResultSearch=function(){var resultsetGrouped=$(".resultsetGrouped");$module_container.find(".rR").on('click',function(e){e.preventDefault();e.stopPropagation();var _this=$(this);if(_this.hasClass('rotating')){_this.removeClass('rotating');while(_this.parent().parent().next().hasClass('dark')){_this.parent().parent().next().remove();}}else{_this.addClass('rotating');$.getScript(overGetParams(_this.parent().parent().data()),function(){_this.parent().parent().after(resultsetGrouped.html());resultsetGrouped.html('');});}});function overGetParams(data){var params=getParams('PRICESGROUP',false,true);params.NIGHTS_FROM=data.nights;params.NIGHTS_TILL=data.nights;params.HOTELS=data.hotel;params.HOTELS_ANY=0;params.PARTITION_PRICE=0;params.SHOW_THEBEST=0;return _ROOT_URL+$.param(params);}};if(parseInt($.getParameter('PARTITION_PRICE',true,$module_container))>0){samo.groupResultSearch();}};samo.initHotelPopup(container);samo.note=function(note){var $container=container.find('.note_container');if(note){$container.ehtml(note).removeClass('blank-note')}else{$container.empty().addClass('blank-note');}};$(document).ready(samo.search_tour);})(samo.jQuery);