<?php
 namespace Samo\AntiBot; use Phalcon\DiInterface; use Phalcon\Session\Adapter\Files as Session; use Phalcon\Di; use Phalcon\Http\Request; use Samo\Logger\Logger; class AntiBot { protected $di; protected $logger; protected $token; protected $request; public function __construct() { $this->di = Di::getDefault(); $this->logger = new Logger(); $this->request = new Request(); $this->token = $this->request->get('token'); } public function isDisable() { $session = $this->di->get('session'); if ($session->get('captchaTTL') < time()) { $session->remove('captcha'); $session->remove('captchaTTL'); } return (!$this->isRobot() || $session->get('captcha')); } private function isRobot() { return $this->logger->updateOnlineStats($this->token); } } 