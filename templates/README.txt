h4. Руководство для дизайнеров и программистов на сайте разработчика: http://dokuwiki.samo.ru/doku.php?id=onlinest:info:design

Шаблоны страниц находятся в директории templates, актуальная документация по используемому синтаксису (Smarty) на сайте проекта: http://www.smarty.net/docs/en/

* templates/header.tpl – "шапка" страниц
* templates/footer.tpl – "подвал" страниц
* templates/login.tpl – форма авторизации


Для того чтобы *разместить javascript-счётчики* (обычно в @footer.tpl@) или добавить @<style>@ воспользуйтесь функцией *literal*: http://www.smarty.net/docs/en/language.function.literal.tpl

<pre>
<!-- counter code begin {literal} -->
	<script type="text/javascript">// <![CDATA[
		var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-XXXXXX-X']);
			_gaq.push(['_trackPageview']);
			(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		// ]]>
	</script>
<!-- counter code end {/literal} -->
</pre>



*Изменения в шаблонах страниц* вступят в силу после очистки директории @tmp/templates_c@.

*На время активного редактирования файлов* допустимо включить принудительную компиляцию шаблонов, указав в @properties.php@ константу:

<pre><code class="php">
define('SMARTY_TEMPLATE_CHECK', true);
</code></pre>

При наличии opcode-кешера (ZendOpcache, XCache, APC) возможна некоторая задержка в применении внесённых правок, временно отключите его в конфигурации вашего веб-сервера.


<pre>
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!       При редактировании шаблонов нельзя удалять css-классы, присвоенные элементам.                     !!
!!       Добавлять новые можно. В случае необходимости допустимо создать отдельную директорию в корне      !!
!!       проекта для размещения изображений, скриптов, файлов стилей.                                      !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre>


*Для изменения стилей* создайте файл public/css/customer.css


<pre>
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!    При изменении какого-либо файла (tpl-шаблона или css-стилей) необходимо информировать разработчика.  !!
!!    В противном случае файл может быть перезаписан при автоматическом обновлении.                        !!
!!    Для связи с разработчиком: https://redmine.samo.ru или mailto:online@samo.ru                         !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre>

*Измененения в программном коде (php и js) будут перезаписаны при обновлении.*

Изменять поведение страниц можно внедрением своего javascript-кода в @public/js/page_callback.js@
   подробнее об этом с документации: http://dokuwiki.samo.ru/doku.php?id=onlinest:info:design#javascript


*Расширение функционала серверного кода (php)* возможно путём наследования существующих классов.
Наименование производного класса в таком случае должно быть @Custom_Здесь_Имя_Базового_Класса@.
Для того чтобы система корректно загрузила новый код потребуется удалить файл @tmp/classmap_cache.php@
  _Разработчик не гарантирует сохранение функционала таких изменений после обновления базовой системы и не
  поддерживает код сторонних специалистов._

 С особой осторожностью следует создавать *копии имеющихся в системе php-файлов* - если копия создаётся в "резервных"
целях - измените расширение файла или (предпочтительней) вынесите файл за пределы DOCUMENT_ROOT. Если файл копируется
для того чтобы создать похожий функционал *обязательно* переименуйте используемые php-классы. В противном случае механизм
используемой автозагрузки может вести себя непредсказуемо.


В следующие директории у пользователя, от имени которого выполняется php должны быть *права на запись*:
* tmp
* tmp/cache
* tmp/templates_c
* tmp/sessions
* dnl
* data/hotel
* data/hotelparam
* data/search_tour
* data/spool
* data/tickets
* data/hedit/*
* data/region
* data/town
* data/state


Для *размещения некоторых страниц на внешних ресурсах* (на основном сайте компании) имеется возможность внедрения форм вставкой @<script>@,
  код для вставки доступен менеджерам заказчика после авторизации в системе управления
  Подробнее в документации: http://dokuwiki.samo.ru/doku.php?id=onlinest:info:design#integracija_stranic_onlajn_bronirovanija_vo_vneshnie_istochniki


Если редактирования шаблонов и стилей недостаточно для реализации необходимого функционала, то можно воспользоваться *API*,
 документация по имеющимся методам опубликована на сайте разработчика: http://dokuwiki.samo.ru/doku.php?id=onlinest:api

*Фоновые задания* должны выполняться системным планировщиком (crond в *nix-like системах, Scheduled Tasks в Windows), для этого необходимо ежеминутно запускать скрипт @cli.php@ (находится в корне проекта). Настоятельно рекомендуем планировать запуск @cli.php@ от имени того же пользователя, под которым запущен php для веб-приложения.

Для работы необходим *php версии не ниже 5.4*, основной поддерживаемой веткой является *php 5.6*. Версии седьмой ветки в настоящий момент не поддерживаются разработчиками используемых драйверов для работы с SQLServer. Проверить перечень необходимых требований можно с помощью php скрипта *requirements.php*: http://dokuwiki.samo.ru/lib/exe/fetch.php?media=samotour:install:requirements.zip

Для связи с разработчиком: https://redmine.samo.ru или mailto:online@samo.ru